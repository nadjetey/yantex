function bindActions(){renderTree(getTopSites()),$("#topsites").bind("click",function(){renderTitle("Most Visited"),toggleActive("#topsites"),renderPage()}),$("#bookmarks").bind("click",function(){renderTitle("Bookmarks Bar"),toggleActive("#bookmarks"),renderPage()}),$("#other").bind("click",function(){renderTitle("Other Bookmarks"),toggleActive("#other"),renderPage()}),$("#devices").bind("click",function(){renderTitle("Mobile Bookmarks"),toggleActive("#devices"),renderPage()})}function getTopSites(){chrome.topSites.get(function(e){renderTree(e)})}function getBookmarks(e){chrome.bookmarks.getTree(function(t){renderTree(t[0].children[e].children)})}function renderPage(){"active"==$("#bookmarks").parent().attr("class")?renderTree(getBookmarks(0)):"active"==$("#other").parent().attr("class")?renderTree(getBookmarks(1)):"active"==$("#devices").parent().attr("class")?renderTree(getBookmarks(2)):"active"==$("#topsites").parent().attr("class")&&renderTree(getTopSites())}function renderTree(e){$("#content .display").children().remove(),$("#content .display").append(printTree(e))}function toggleActive(e){$(e).parent().parent().children().removeClass("active"),$(e).parent().toggleClass("active")}function printTree(e){var t,d=$("<ul></ul>");for(var a in e)e[a].children?($(d).append(printNode(e[a])),t=printTree(e[a].children),$(t).attr("id","folder"+e[a].id),(null==localStorage.getItem("folder"+e[a].id)||"hide"==localStorage.getItem("folder"+e[a].id))&&$(t).hide()):t=printNode(e[a]),$(d).append(t);return d}function printNode(e){var t=e.children?$('<li id="'+e.id+'" class="folder"></li>').append($('<a><span class="arrow">'+("show"==localStorage.getItem("folder"+e.id)?"&#x25bc;":"&#x25b6;")+'</span><img src="/icons/folder.png" alt="" /><span class="title">'+e.title+" ("+e.children.length+") </span></a>").bind("click",{id:e.id},toggleFolder)):$('<li id="'+e.id+'" class="link"></li>').append('<a href="'+e.url+'" title="'+e.title+'" '+(localStorage.getItem("newTab"+e.id)?'target="_blank"':"")+'><img src="chrome://favicon/'+e.url+'" alt="" /><span class="title">'+(""==e.title?"<i>"+e.url+"</i>":e.title)+"</span></a>");return $(t).append($('<a class="edit">edit</a>').bind("click",{node:e},toggleEdit)),null!=e.children&&$(t).append($('<a class="openall">open all</a>').bind("click",{node:e},toggleOpenAll)),t}function toggleFolder(e){var t=$("ul#folder"+e.data.id);"block"==$(t).css("display")||""==$(t).css("display")?($(t).slideUp("fast").prev().find("span.arrow").html("&#x25b6;"),localStorage.setItem("folder"+e.data.id,"hide")):($(t).slideDown("fast").prev().find("span.arrow").html("&#x25bc;"),localStorage.setItem("folder"+e.data.id,"show"))}function toggleEdit(e){if(1==$("li#edit"+e.data.node.id).length)return $("li#edit"+e.data.node.id).remove(),!1;var t=$("<button>Remove</button>").bind("click",{node:e.data.node},removeBookmark),d=$("<button>Cancel</button>").bind("click",{node:e.data.node},cancelEdit),a=$("<button><b>Done</b></button>").bind("click",{node:e.data.node},saveEdit);$("li#"+e.data.node.id).after($('<li id="edit'+e.data.node.id+'" class="edit"><table><tbody><tr><td>Title:</td><td><input type="text" name="title" value="'+e.data.node.title.replace(/"/g,"&quot;")+'" /></td></tr>'+(e.data.node.children?"":'<tr><td>URL:</td><td><input type="text" name="url" value="'+e.data.node.url.replace(/"/g,"&quot;")+'" /></td></tr>')+"</tbody></table>"+(e.data.node.children?"":'<p class="newTab"><input type="checkbox" id="newtab'+e.data.node.id+'" '+(localStorage.getItem("newTab"+e.data.node.id)?'checked="checked"':"")+'/> <label for="newtab'+e.data.node.id+'">Open in new tab</label></p>')+"</li>").append($('<p class="buttons"></p>').append(t).append(d).append(a)).append('<div class="clearer"></div>'))}function removeBookmark(e){if(e.data.node.children){if(!confirm("Delete folder?"))return!1;chrome.bookmarks.removeTree(e.data.node.id),$("ul#folder"+e.data.node.id).remove()}else chrome.bookmarks.remove(e.data.node.id);$("li#"+e.data.node.id).remove(),$("li#edit"+e.data.node.id).remove()}function cancelEdit(e){$("li#edit"+e.data.node.id).remove()}function saveEdit(e){var t=new Object;if(t.title=$("li#edit"+e.data.node.id+" input[name=title]").val(),$("li#"+e.data.node.id+" span.title").html(t.title),!e.data.node.children){var d=$("li#edit"+e.data.node.id+" input[name=url]").val();d.match(/^https?:\/\//)||(d="http://"+d),t.url=d,$("li#"+e.data.node.id+" a:first").attr("href",d)}chrome.bookmarks.update(e.data.node.id,t),localStorage.setItem("newTab"+e.data.node.id,$("li#edit"+e.data.node.id+" input[type=checkbox]").attr("checked")),$("li#edit"+e.data.node.id).remove()}function toggleOpenAll(e){}function renderTitle(e){$("#content #title").text(e)}window.onload=bindActions;
